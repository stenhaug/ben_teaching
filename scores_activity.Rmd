---
title: "scores_activity"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = FALSE)
library(tidyverse)
library(stringr)
library(modelr)
```

# Instructions

You'll submit your output file and a syntax file (if you choose to use one). You will also submit a word or google doc file where you answer the open questions and include any key output you use to answer the questions such as graphs etc.

Some of this is pretty tricky! I encourage you to google it and flounder and do your best but also don't be afraid to use this [hints and help doc](https://docs.google.com/document/d/1_8ZsVw3JLIVnM8w-9dijhuEGp7VnhuKd7hhK2_I2ru8/edit).

# Background

The principal of Warren Early College High School, Dr. Baker, experimented with three different class sizes this past year: small, medium, and large. She is interested in if class size seems to have an effect on math and reading test scores. [The dataset scores](https://drive.google.com/open?id=0BxNjWD0-A_iaNHNPeDdnaHgwcWs) includes information on the student, the class size they were in, and their math and reading scores. The scores are reported as standard scores which at the population level have a mean of 100 and a standard deviation of 15 (similar to popular IQ tests).

# Cleaning

One thing you'll notice is that both household income and test scores are not stored as numbers. Start by finding a way to clean the data. In particular:

1. Remove the k from household_income to get just the number
2. Make a math_test_score and a reading_test_score column and store a number in there (this will make the dataset half as long)... Note this is tricky! Here are some steps that might help:

- Convert the current test_score column into two separate columns: test_name (reading for example) test_score_numeric (102 for example)
- Reshape the data  

```{r}
scores <- scores %>% 
  mutate(household_income = household_income %>% str_replace("k", "") %>% as.numeric(),
         test_name = test_score %>% str_extract("[:alpha:]+"),
         test_score = test_score %>% str_extract("\\d+") %>% as.numeric()) %>% 
  spread(key = test_name, value = test_score)
```

# Explore generally

Explore the scores dataset. At a minimum, be sure to answer the following questions:

1. How many students are in the dataset?
1. How many students are in each class size?
1. What is the gender breakdown? Does it appear to vary by class size?
1. What is the distribution of household incomes? Does it appear to vary by class size?
1. What is the distribution of test scores? Do they appear to vary by class size?

```{r}
nrow(scores)

scores %>% count(class_size)

scores %>% count(gender)
scores %>% count(class_size, gender)

scores %>% 
  ggplot(aes(x = household_income, fill = class_size)) +
  geom_density(alpha = 0.5)

scores %>% 
  ggplot(aes(x = math, fill = class_size)) +
  geom_density(alpha = 0.5)

scores %>% 
  ggplot(aes(x = reading, fill = class_size)) +
  geom_density(alpha = 0.5)
```

# Math

1. Run a t-test to compare the small clase size math scores to the large class sizes math scores. What can you conclude?

```{r}
t.test(math ~ class_size, var.equal = TRUE, data = scores %>% filter(class_size != "medium"))
```

1. Run an anova to see if math scores vary by class size. What can you conclude?

```{r}
summary(aov(math~class_size, data = scores))
```

1. Run a regression with y = math and x = class_size. How does this compare to the anova?

```{r}
mod <- lm(math ~ class_size, data = scores)
summary(mod)
```

1. Now add in household_income as an independent variable into the regression. What changes? What can you conclude?

```{r}
mod <- lm(math ~ class_size + household_income, data = scores)
summary(mod)
```

1. Add in gender as well. What can you conclude?

```{r}
mod_math <- lm(math ~ class_size + household_income + gender, data = scores)
summary(mod)
```

# Reading

1. Run a regression to determine the effect of class size on reading. What do you find? How does it compare to math?

```{r}
mod_reading <- lm(reading ~ class_size + household_income + gender, data = scores)
summary(mod)
```

# Prediction

Make a prediction for each of the following students math and reading scores:

- Male, household income of 50k, in a small class size
- Male, household income of 50k, in a medium class size
- Male, household income of 50k, in a large class size

- Female, household income of 100k, in a small class size
- Female, household income of 100k, in a medium class size
- Female, household income of 100k, in a large class size

```{r}
data_to_predict <- tribble(
  ~gender, ~household_income, ~class_size,
  "male",     50,    "small",
  "male",     50,    "medium",
  "male",     50,    "large",
  "female",   100,    "small",
  "female",   100,    "medium",
  "female",   100,    "large"
)

data_to_predict %>% 
  add_predictions(mod_math, "pred_math") %>% 
  add_predictions(mod_reading, "pred_reading") %>% 
  mutate_if(is.numeric, round)
```

# Suggestion

Time to make a decision. It costs the school 4k a year to have a kid in a small class size for the year, 3k a year for a medium class size, and 2k a year for a large class size. What size classes would you suggest the school uses for their students. Why? Be sure to consider other uses of school funds. 

# Challenge

So I actually prefer R because I find it to be more powerful and easier to use once you get over the intial learning curve. I created and solved much of the activity in [R here](https://github.com/stenhaug/ben_teaching/blob/master/scores_activity_solutions.md). Take a look at the code. What can you make of it? What parts seem easier and what parts seem more confusing than spss?
